\input{common/header.tex}
\inbpdocument

\chapter{Representing probability distributions of exchangeable arrays}
\label{ch:arrays}

In chapter~\ref{ch:networks} we demonstrated how to characterise probability distributions over objects such as networks or user--item rating matrices.
The key properties that allowed us to characterise these distributions were symmetries in the data, or invariances to the way they are stored.
For networks, we assumed that the ordering of the nodes contained no information.
For user--item data we assumed that the order of both users and items were irrelevant to the meaning of the data.

In this chapter we extend these ideas of exchangeability to any data that can be stored in a relational database.
We demonstrate that extensions of the \NA{Aldous--Hoover} theorem to $n$-arrays due to Kallenberg \NA{cite} are self strengthening to the case of exchangeable databases.
These new theorems reveal a natural parameter space for data stored in relational databases elucidating how to construct appropriate statistical models for such data.

This chapter is largely based on collaborations with Zoubin Ghahramani, Peter Orbanz and Daniel Roy.
In particular, the theorems presented in this chapter appeared at \NA{BNP} and \NA{NIPS} workshops but without proof.

\section{Introduction}

Relational databases are an extremely common data structure so it is natural to want to perform statistical tasks with such data \eg predicting unobserved data or identifying latent structure.
In particular, network data is rarely encountered in isolation \eg in a social network one will often have access to side information about each user.
To perform a statistical analysis of such data we need to estimate parameters of a probabilistic model, but it is not immediately clear what an appropriate parameter space for such a model is.
The choice of parameter space is important because it indicates the targets of statistical inference and shows where we can share statistical strength between different aspects of the data.

We demonstrate that the weak assumption of an appropriate form of exchangeability can provide a natural parameter space.
%Exchangeability is a reasonable assumption whenever we can faithfully model our data as being a random finite sample from some theoretical infinite population where the order of sampling does not matter.
This form of exchangeability is appropriate when the order of the objects underlying a relational database (\eg users and movies in a database of ratings data) is arbitrary or unimportant.
For example, the left hand side of figure~\ref{fig:exchangeable} shows the same network but with differently labeled nodes.
If the labeling is unimportant, then any probabilistic model of such data should assign them the same probability.

\begin{figure}[t]
\centering
\begin{tabular}{c}
\tiny \input{\arraysfigsdir/exchangeable}
\end{tabular}
\caption{Left: Networks with equivalent structure but different node labels. Right: Corresponding adjacency matrix representations of these networks}
\label{fig:exchangeable}
\end{figure}

Relational data are typically stored in arrays; the right hand side of figure~\ref{fig:exchangeable} shows the corresponding adjacency matrix representations of the networks on the left.
We demonstrate that exchangeability of the objects underlying a relational database can be expressed in terms of array exchangeability.
Prior work on array exchangeability, both theoretical \citep[e.g.][]{Hoover1979, Aldous1981a, Hoover1982, Kallenberg1999a, Diaconis2007, Aldous2010, Austin2012, Choi2012, Wolfe2013} and applied \citep[e.g.][]{Hoff2007a,Roy2009,Lloyd2012}, has focused on single exchangaeble arrays.
We show that the representation theorems for single arrays can be used to derive representations for collections of exchangeable arrays \ie exchangeable databases.

\section{Exchangeable databases}

We abstractly define a database following the entity-relationship formalism \citep[e.g.][]{Ullman2002} where the values of attributes are the result of evaluating functions (relations) over a collection of entities / objects.

\newcommand{\bi}{\bm{i}}
\newcommand{\Types}{T}
\newcommand{\Space}{S}
\begin{definition}[types, signatures, relation]
Fix a finite set $\Types$ of \defn{types}.  Define a \defn{signature} to be a finite sequence $s \in \Types^d$ of types.
Define a \defn{relation $r$ of signature $s \in \Types^d$ with values in a space $\Space$} to be a function from $\Nats^d$ to $\Space$.
\end{definition}

We may encode a relation $r$ with signature $s \in \Types^d$ as an array $X^r \defas (X^r_{\bi})_{\bi \in \Nats^d}$ given by
\[
X^r_{\bi} = r(i_1,\dotsc,i_d), \qquad \text{for } \bi = (i_1,\dotsc, i_d) \in \Nats^d.
\]

\begin{example} 
Let $\Types = \{\textit{users,movies}\}$.
A relation $r$ of signature $(\textit{users},\textit{movies})$ taking values in $\{1,2,3,4,5\}$ might store movie ratings with rows corresponding to some enumeration of \textit{users}, and columns corresponding to some enumeration of \textit{movies}. 
A relation $r'$ of signature $(\textit{users},\textit{users})$ taking values in $\{0,1\}$ might store the symmetric friendship relations in a social network.
\end{example}

\begin{definition}[database]
Define a \defn{database} to be a collection of $R$ relations $r_1,\dotsc,r_R$ of signature $s_1,\dotsc,s_R$, respectively, taking values in $\Space_1,\dotsc,\Space_R$, respectively.
\end{definition}

We may encode a database as a collection of arrays $(X^{r_j})_{j=1}^R$, where $X^{r_j}$ encodes the relation $r_j$.  
For notational simplicity, we will often refer to the collection of arrays $(X^{r_j})_{j=1}^R$ as if it were the database itself.
%For notational simplicity, we will sometimes write $(X^r)$ to denote such a collection of arrays.

Permuting the ordering of objects within a database results in a permutation of the indices of several of the arrays encoding its relations.
For each type $t \in \Types$, let $p_t \in \SGinf$ be a permutation of $\Nats$. 
Write $p = (p_t ; t \in \Types) \in \SGinf^T$ for the collection of such permutations.
Given a signature $s \in \Types^d$, define $p^s$ to be the map from $\Nats^d$ to $\Nats^d$ such that
\[
p^s(\bi) \defas (p_{s_1}(i_1), \dotsc,p_{s_d}(i_d)), \qquad \text{for } \bi \in \Nats^d.
\]
In other words, $p^s$ maps a sequence $i_1,\dotsc,i_d$ of indices (indexing objects of type $s_1,\dotsc,s_d$, respectively) to the sequence where each index is permuted by the permutation corresponding to its type.

If $X^r$ is the encoding of a relation $r$ with signature $s \in \Types^d$, then the permuted relation $r \circ p$ is represented by the array $X^{r\circ p}$ given by
\[
X^{r \circ p}_{\bi} = X^r_{p^s(\bi)}, \qquad \text{for } \bi \in \Nats^d.
\]

%The permutation of a database $(X^r)$ by $p$ is simply the database $(X^r \circ p)$.

\begin{definition}[exchangeable database]
We say that a random database $(X^{r_j})_{j=1}^R$ is \emph{exchangeable} when it has the same distribution as $(X^{r_j\circ p})_{j=1}^R$ for every $p \in \SGinf^T$.
\end{definition}

%If the ordering of all objects is arbitrary, then $X^r$ is $\pi$-exchangeable where $\pi$ is the partition of consecutive integers with lengths $m^r_1, m^r_2, \ldots, m^r_O$.

%\PROBLEM{Here}

%Let $\Law(Y)$ be the law (distribution) of a random variable $Y$ and define $\chi_m X \defas (X_{i_1\ldots i_d}; \ i_j \le m )$.

The following result characterises the distribution of any exchangeable database to arbitrary accuracy.

\begin{cor}[functional representation for exchangeable databases]
  \label{cor:simple-database}
   Let $(X^{r_j})_{j=1}^R$ be an exchangeable random database.
   Then there exists a sequence of random measurable functions $F^{j,1}, F^{j,2}, \dotsc$ for 
   every $j=1\ldots R$ and collection of \iid Uniform$[0,1]$ random variables $(\AHvar^t_i)_{i\in\Nats,t \in \Types}$ such that 
   the random databases $(X^{r_j,n})_{j=1}^R$
    converge in distribution to $(X^{r_j})_{j=1\ldots R}$ as $mn\to \infty$, where   
%   the sequence of arrays $X^{j,1},X^{j,2},\dotsc$, for $j \in \{1,\dotsc,R\}$, given by
   \[
     X^{r_j,n}_{\bi} := F^{j,n}(\AHvar^{s_j(1)}_{i_1},\dotsc,\AHvar^{s_j(d)}_{i_d}), \qquad \text{for } \bi \in \Nats^d.
   \]
\end{cor}

This a corollary of a stronger theorem presented in section~\ref{sec:proof_database} which states that the law of fixed subarrays are mutually absolutely continuous and the associated Radon-Nikodym derivatives converge uniformly to $1$ as $n \to \infty$.
We also preset an almost-sure representational result which requires some heavy notation which we build up in subsequent sections.

%are mutually absolutely continuous for all $m,n \in \Nats$ and the as
%   $\Law((\chi_m X^{j,n})_{j=1\ldots R})$ and $\Law((\chi_m X^{r_j})_{j=1\ldots R})$ are mutually absolutely continuous for all $m,n \in \Nats$ and the associated Radon--Nikodym derivatives converge uniformly to 1 as $n \to \infty$ for fixed $m$.
%\end{thm}

To demonstrate this theorem, we present two special cases of this result applicable to modelling a network with side information for each node and a social network with associated user-item data.

\begin{cor}
  Consider an exchangeable database with one object type, one unary relationship, and one binary relationship; denote the binary relationship by the array $X=(X_{i,j})_{i,j\in\Nats}$ and the unary relationship with the sequence $C=(C_i)_{i\in\Nats}$.
   Then there exists a sequence of pairs of random measurable functions $(F^n, G^n)_{n\in\Nats}$ and a collection of \iid Uniform$[0,1]$ random variables $(\AHvar_{i})_{i\in\Nats}$ such that if we define the arrays $X^1,X^2,\dotsc$ and sequences $C^1,C^2,\dotsc$ by
   \[ 
     X^n_{i,j} &\defas F^n(\AHvar_{i},\AHvar_{j}), \qquad \text{for } i,j,n\in\Nats, \\
     C^n_{i} &\defas G^n(\AHvar_{i}), \qquad \text{for } i,n\in\Nats,
    \]
   then $(X^n,C^n)$ converges in distribution to $(X,C)$ as $n \to \infty$.
\end{cor}

\begin{cor}
  Consider an exchangeable database with two object types, one binary relation between two objects of the first type and a binary relation between objects of different types;  denote the first relation by the array $X=(X_{i,j})_{i,j\in\Nats}$ and the second by $Y=(Y_{i,k})_{i,k\in\Nats}$.
   Then there exists a sequence of pairs of random measurable functions $(F^n, G^n)_{n\in\Nats}$ and a collection of \iid Uniform$[0,1]$ random variables $(\AHvar_{i})_{i\in\Nats}, (\AHvaralt_{i})_{i\in\Nats}$ such that if we define the arrays $X^1,X^2,\dotsc$ and  $Y^1,Y^2,\dotsc$ by
   \[ 
     X^n_{i,j} &\defas F^n(\AHvar_{i},\AHvar_{j}), \qquad \text{for } i,j,n\in\Nats, \\
     Y^n_{i,k} &\defas G^n(\AHvar_{i}, \AHvaralt_{k}), \qquad \text{for } i,k,n\in\Nats,
    \]
   then $(X^n,Y^n)$ converges in distribution to $(X,Y)$ as $n \to \infty$.
\end{cor}

%\begin{cor}
%  Consider an exchangeable database with one object type, a unary relationship and a binary relationship; denote the binary relationship by the array $(X_{ij})$ and the unary relationship with the sequence $(C_i)$.
%   Then there exists a sequence of pairs of random measurable functions $(F_n, G_n)_{n\in\Nats}$ and a collection of \iid Uniform$[0,1]$ random variables $(\AHvar_{i})_{i\in\Nats}$ such that if we define
%   \begin{equation}
%     ((X_n), (C_n)) := ((F_n(\AHvar_{i},\AHvar_{j}))_{i,j\in\Nats},(G_n(\AHvar_{i}))_{i\in\Nats})
%   \end{equation}
%   then $\Law((\chi_m X_n),(\chi_m C_n)) \textrm{ and } \Law((\chi_m X),(\chi_m C))$ are mutually absolutely continuous for all $m,n \in \Nats$ and the associated Radon--Nikodym derivatives converge uniformly to 1 as $n \to \infty$ for fixed $m$.
%\end{cor}

%\emph{Proof mechanism:}
%
%Each of the arrays $(X^r)$ is $\pi$-exchangeable (see \cite{kallenberg1999multivariate}).
%The collection of arrays can be collected into one larger array (with many duplicated entries) which is still $\pi$-exchangeable.
%We then appeal to theorem 2 of \cite{kallenberg1999multivariate} to get a functional representation of the distribution of the larger array.
%The redundancy of the representation in the larger array can be removed by integrating over the redundant elements.
%These integrals constitute the functions $(F^r_n)$ and the proof concludes by demonstrating the reuqired properties of these functions.\hfill{$\square$}

\begin{rem}[uniform distributions]\label{rem:uniform}
The uniform distributions in the theorem are canonical but the theorem still holds with any non-atomic probability measure on a Borel space \eg Gaussian distributions.
\end{rem}
%\begin{rem}[Characteristing the distribution exactly]\label{rem:exact}
%The Aldous--Hoover theorem \cite{Aldous1981a, Hoover1979} for exchangeable arrays demonstrates the existence of functional representations that are equal in distribution to exchanegable arrays.
%A generalisation to exchangeable databases that is analagous to theorem~\ref{thm:simple-database} can be derived but is omitted for brevity since it is significantly more cumbersome to express.
%\end{rem}

\begin{rem}[random functions]\label{rem:randfunc}
\TBD{Explain precisely what is meant by a random function}
\end{rem}

\subsection{Intepretation and examples}

Corollary~\ref{for:simple-database} states that the joint distribution of an exchangeable database can be arbitrarily well approximated by a collection of random measurable functions and uniform random variables.
This functional form provides a set of parameters to be estimated that are naturally hierarchical.
The functions $(F^{j,n})$ capture properties of entire relations whilst the $(U^t_i)$ represent randomness associated with particular objects underlying the relational data.

\subsubsection{Example : Exchangeable networks}

Consider modeling a single binary relation which indicates whether or not two nodes in a network are connected or not.
This data is typically represented in the form of an adjacency matrix $(X_{ij})$ where $X_{ij} = 1$ if and only if node $i$ is connected to node $j$.
Theorem~\ref{thm:simple-database} states that if the distribution of $X$ is exchanegable then it can be arbitrarily well approximated by
\begin{equation}
(F(\AHvar_i, \AHvar_j))
\end{equation}
where $F$ is a random measurable function and $(U_i)$ are \iid Uniform$[0,1]$ random variables.
This special case has been used previously by \cite{Hoff2007a,Roy2009,Lloyd2012} to inspire probabilistic models of networks of the form
\begin{eqnarray}
(\AHvar_i) & \simiid & \textrm{\eg Gaussian} \\
F & \sim & \textrm{\eg Gaussian process, bilinear function}\ldots \\
W_{ij} & := & F(\AHvar_i, \AHvar_j) \\
X_{ij} | W_{ij} & \sim & \textrm{Bernoulli}(\sigma(W_{ij}))\label{eq:graphon}.
\end{eqnarray}
This is demonstrated pictorially in figure~\ref{fig:graphon}; in this case $F$ can be interpreted as a blurred adjacency matrix.

\begin{figure}[ht]
\centering
\begin{tabular}{c}
\input{\arraysfigsdir/fig_graphon_wide}
\end{tabular}
\caption{
A pictorial representation of a model for network data inspired by the Aldous--Hover representation theorem.
The left shows a random sample of a binary network (represented by an adjacency matrix) generated by a model of the form given by equation~\eqref{eq:graphon}.
}
\label{fig:graphon}
\end{figure}

\subsubsection{Example : A simple database}

Consider the simple database shown on the left hand side of figure~\ref{fig:multi-rel-seq}.
There are two objects, students and courses, and three relations, the unary relation `age' acting on students, the binary relation `friends' acting on pairs of students and the binary relation `grade' that acts on students and courses.
Sample data encoded in arrays is shown at the bottom of this figure.

Exchangeability of this database means that the entries of the leftmost table, the rows and columns of the second table and the rows of the third table can be arbitrarily permuted without changing the distribution of the database when viewed as a random variable.
Similarly the columns of the rightmost table may be independently arbitrarily permuted.

The functional form resulting from the application of theorem~\ref{thm:simple-database} to this data structure is shown on the right hand side of figure~\ref{fig:multi-rel-seq}.
The two objects are represented by \iid random variables, $(U_i)$ for students, $(V_i)$ for courses and the three relations are represented by three random functions $F(\AHvar_i),G(\AHvar_i,\AHvar_j)$ and $H(\AHvar_i,\AHvaralt_j)$ whose inputs are the random variables representing the objects the relations act upon.

\begin{figure}[ht]
\centering
\begin{tabular}{cc}
\tiny \input{\arraysfigsdir/multi_rel_seq} & \tiny \input{\arraysfigsdir/multi_rel_seq_U_F}
\end{tabular}
\caption{Left: A pictorial representation of a relational database. Right: The functional representation of the distribution of data of this form guaranteed to be an arbitrarily good approximation by theorem~\ref{thm:simple-database}}
\label{fig:multi-rel-seq}
\end{figure}

\section{Proof of exchangeable database representation theorem}
\label{sec:proof_database}

\subsection{Background: $\pi$-exchangeability}

This section reviews material from \TBD{cite Kallenberg}.

Let $\pi$ be a partition of the set $\{1,\dots,d\}$ and $p = \{p^{\pi_i} : i = 1,\dots,d\}$ be a collection of permutations of $\Nats$ where $\pi_i \defas \{I \in \pi : i \in I\}$.
We say that an array $X^r$ representing relation $r$ is $\pi$-exchangeable if 
\begin{equation}
  X^{r\circ p} \eqd X
\end{equation}
for all collections $p$ of permutations of $\Nats^d$ of the form given above.
Note that this is precisely the type of symmetry we encountered for exchangeable databases.

We say that a $\pi$-exchangeable array $X$ is simple if it admits a functional representation of the form
\begin{equation}
  X_{\bi} = F(U, U^{\pi_1}_{\bi_1}, \dots, U^{\pi_d}_{\bi_d})
\end{equation}
where $F$ is a measurable function and $U, U^{\pi_j}_{\bi_j}$ are \iid Uniform$[0,1]$ random variables.

\begin{prop}[Borel hypercube]
  \label{prop:hypercube}
  Result about encoding arbitrarily many random variables with functions and a uniform random variable
\end{prop}

\begin{thm}[$\pi$-exchangeability representation theorem]
  \label{thm:piex}
  Let $X$ be a $\pi$-exchangeable array.
  Then there exist some simple $\pi$-exchangeable arrays $X_1$ , $X_2$ , \dots such that
  $\Law(\chi_m X_n) \sim \Law(\chi_m X)$ for all $m,n \in \Nats$ and the associated densities tend
  uniformly to 1 as $n \to \infty$ for fixed $m$.
\end{thm}

where $\Law$ represents the distribution or law of a random variable, $X \sim Y$ indicates that the distributions $X$ and $Y$ are mutually absolutely continuous and $\chi_m$ is the array subset operation such that $\chi_m X \defas \{X_{\bi} : \bi \in \{1,\dots,m\}^d\}$.

We say that an exchangeable database $(X^{r_j})_{j=1}^R$ is simple if it admits a functional representation of the form
\begin{equation}
  X^{r_j}_{\bi} = F^{r_j}(U, U^{s_{j}(1)}_{\bi_1},\dots,U^{s_{j}(d_j)}_{\bi_{d_j}}) \,\, \forall \,\, \bi \in \Nats^{d_j} \,\, \forall \,\, j \in {1,\dots,R}.
\end{equation}

We can now state and prove the simple database representation theorem.

\begin{thm}[Simple exchangeable database representation theorem]
  \label{thm:simple-database}
  Let $(X^{r_j})_{j=1}^R$ be an exchangeable database.
  Then there exist some simple exchangeable databases $(X^{r_j,1})_{j=1}^R$ , $(X^{r_j,2})_{j=1}^R$ , \dots such that
  $\Law(\chi_m (X^{r_j,n})_{j=1}^R) \sim \Law(\chi_m (X^{r_j})_{j=1}^R)$ for all $m,n \in \Nats$ and the associated densities tend
  uniformly to 1 as $n \to \infty$ for fixed $m$.
\end{thm}

\begin{proof}
  Each array $(X^{r_j})$ is $\pi$-exchangeable where $\pi$ is given by the blocks of $\{1,\dots,n_j\}$ whose signature have the same type.
  We can therefore apply theorem~\ref{thm:piex} to each array separately resulting in representations
\begin{equation}
  G^{r_j,n}(U^j,U^{s_{j}(1),j}_{\bi_1},\dots,U^{s_{j}(d_j),j}_{\bi_{d_j}})
\end{equation}
We tie these representation together by applying proposition~\ref{prop:hypercube} to the collections of uniforms $(U^{t,j}_{\bi})_{j=1}^R$, encoding them as a single uniform random variable
\begin{equation}
  U^t_{i} = H^t(U^{t,1}_{i},\dots,U^{t,R}_{i})
\end{equation}
where $H^t$ is bi-measurable and similarly for $U = H^t(U^{1},\dots,U^{R})$.
Notice that $U_{\bi}, U^t_{\bi}$ are independent by construction.
We now define functions
\begin{equation}
F^{r_j,n}(U,U^{s_{j}(1)}_{\bi_1},\dots,U^{s_{j}(d_j)}_{\bi_{d_j}}) = G^{r_j,n}(U^j,U^{s_{j}(1),j}_{\bi_1},\dots,U^{s_{j}(d_j),j}_{\bi_{d_j}})
\end{equation}
which are measurable by the measurability of $G$ and $H$.
We are now essentially done.
\end{proof}

\begin{rem}[simpler proof mechanisms that do not work]
\label{rem:randfunc}
\NA{
The above proof mechanism is somewhat concise and feels a little bit non-constuctive when invoking the Borel hypercube isomorphism theorem.
}
\end{rem}

\section{An almost sure representation theorem}
\label{sec:almost_sure}

To prove an almost sure representational theorem will require some considerably more difficult notation.
We have followed the notation in \NA{Kallenberg} but we have adapted it to try to make it easier to understand.
However, there is only so much we can do so we provide corollaries of the theorem after its statement and proof to demonstrate that behind the notation are some fairly simple concepts.
Brace yourself.

We define for each $k \in \Nats^d$ and $I \subset \{1,\ldots,d\}$ a set $k_I \subset \Nats$ by
\begin{equation}
k_I = \{k_i: i \in I\}, \quad k \in \Nats^d
\end{equation}
\ie $k_I$ only includes certain indices.

We further define $k_{\pi I}$ by
\begin{equation}
  k_{\pi I} = (k_{I \cap J} : J \in \pi)
\end{equation}
N.B. we have replaced Kallenberg's function notation with a list since this may be more natural to the readers of this work.
Let $\Nats^{\leq d}$ be the collection of all subsets of the naturals $K \subset \Nats$ with cardinality $|K| \leq d$.

\begin{prop}[\citet{Kallenberg1999-pj}]
\label{prop:piexas}
  Let $X$ be a random $d$-array in a Borel space $S$.
  Then $X$ is $\pi$-exchangeable iff there exists a measurable function $f:[0,1]^{2^d}\to S$ and a $U$-array $\xi$ with index set $\prod_{J\in\pi} \Nats^{\leq |J|}$ such that
  \begin{equation}
    X_k = f(\xi_{k_{\pi I}} : I \subset \{1,\ldots,d\}) \ \as, \quad k \in \Nats^d.
    \label{eq:piexas}
  \end{equation}
\end{prop}

We now extend this theorem to the case of an exchangeable database.
We will spend some time defining notation specific to a particular exchangeable database; the proof will then follow concisely.

Start with an exchangeable database $(X^{r_j})_{j=1}^R$.
Assume w.l.o.g.\ that the types are ordered (\eg type 1, type 2,\dots) and the types in each signature respect this ordering (\eg $s = (1,1,2,3,3,\dots)$).
Define the multiplicity of a type $t$ in signature $s$ by the number of times the type appears in the signature, and denote this by $m_{t}^s$.
Define the maximum multiplicity of a type $t$ in a database as $m_t = \max_j m_t^{s_j}$.
Let $d = \sum_{t\in T} m_t$ be the sum of the multiplicities.
Let $d_j = \sum_{t\in T} m_t^s$ be the sum of the multiplicities for a particular signature.
Let $\pi$ be the partition of $\{1,\ldots,d\}$ consisting of consecutive blocks of integers with sizes equal to $\{m_1,\ldots,m_T\}$.
For a signature $s$ let $I_s$ be the subset of $\{1,\ldots,d\}$ that contains the first $m_1^s$ integers and then not the next $m_1 - m_1^s$ integers, then the next $m_2^s$ integers, and then not the next $m_2 - m_2^s$ integers and so on.
Finally, let $\mathbb{I}_s$ be the indicator function of the set $I_s$ within $\{1,\ldots,d\}$ and let $k^s \defas (k_i : i \in I_s)$.
Let $\pi_s \defas \{J \cap I_s : J \in \pi\}$

\begin{thm}[almost sure functional representation for exchangeable databases]
  \label{thm:as-database}
  A database $(X^{r_j})_{j=1}^R$ is exchangeable iff there exist measurable functions $f^j : [0,1]^{2^{d_j}} \to S_j$ such that
  \begin{equation}
    X_{k^{s_j}}^{r_j} = f^j(\xi_{k_{\pi I}} : I \subset I_{s_j}) \ \as, \quad k \in \Nats^d, \ j \in \{1,\ldots,R\}.
  \end{equation}
\end{thm}

\begin{proof}
Collections of arrays with this functional form are trivially exchangeable databases, so we include only the proof that exchangeable databases have this functional form.
Each array $X^{r_j}$ in an exchangeable database is $\pi_{s_j}$-exchangeable by definition.
Therefore, by proposition~\ref{prop:piexas} we have an almost sure representation
\begin{equation}
  X^{r_j}_{k^{s_j}} = g^j(\xi^j_{k_{\pi_{s_j} I}} : I \subset I_{s_j}) \ \as, \quad k \in \Nats^d
\end{equation}
Note this is exactly equation~\ref{eq:piexas} but with $\{1,\dots,d\}$ replaced by $I_{s_j}$.
Trivially, we can replace the $\pi_{s_j}$ in the previous expression with $\pi$ alone.
We now invoke proposition~\ref{prop:hypercube} to recode our $U$-array
\begin{equation}
  \xi_{\bi} = h((\xi^j_{\bi})_{j=1}^R) \,\, \forall \,\, \bi \in \prod_{J\in\pi} \Nats^{\leq |J|}
\end{equation} 
and then we just define some new measurable functions
\begin{equation}
  f^j(\xi_{k_{\pi_{s_j} I}} : I \subset I_{s_j}) = g^j(\xi^j_{k_{\pi_{s_j} I}} : I \subset I_{s_j}) \ \as, \quad k \in \Nats^d
\end{equation}
and we are essentially done.
\end{proof}

\subsection{Examples}

\begin{cor}
  Consider an exchangeable database with one object type, one unary relationship, and one binary relationship; denote the binary relationship by the array $X=(X_{i,j})_{i,j\in\Nats}$ and the unary relationship with the sequence $C=(C_i)_{i\in\Nats}$.
   Then there exist measurable functions $(F, G)$ and a collection of \iid Uniform$[0,1]$ random variables $U, (\AHvar_{i})_{i\in\Nats}, (\AHvar_{\{i,j\}})_{i,j\in\Nats}$ such that
   \[ 
     X_{ij} & = F(U, \AHvar_{i},\AHvar_{j}, \AHvar_{\{i,j\}}), \qquad \text{for } i,j,n\in\Nats, \\
     C_i & = G(U, \AHvar_{i}), \qquad \text{for } i,n\in\Nats,
    \]
almost surely.
\end{cor}

That is, this is the Aldous--Hoover representation for a jointly exchangeable array and the DeFinetti representation of an exchangeable sequence at the same time, with coupled uniform random variables.

\begin{cor}
  Consider an exchangeable database with two object types, one binary relation between two objects of the first type and a binary relation between objects of different types;  denote the first relation by the array $X=(X_{i,j})_{i,j\in\Nats}$ and the second by $Y=(Y_{i,k})_{i,k\in\Nats}$.
   Then there exists a pair of measurable functions $(F, G)$ and a collection of \iid Uniform$[0,1]$ random variables $U, (\AHvar_{i})_{i\in\Nats}, (\AHvaralt_{i})_{i\in\Nats}, (\AHvar_{\{i,j\}})_{i,j\in\Nats}, (W_{i,j})_{i,j\in\Nats}$ such that
   \[ 
     X_{ij} & = F(U,\AHvar_{i},\AHvar_{j},  \AHvar_{\{i,j\}}),  \qquad &\text{for } i,j\in\Nats, \\
     Y_{ik} & = G(U, \AHvar_{i}, \AHvaralt_{k}, W_{ik}), \qquad &\text{for } i,k\in\Nats,
    \]
almost surely.
\end{cor}

That is, this is the Aldous--Hoover representation for a jointly exchangeable array and the Aldous--Hoover representation of a separately exchangeable array at the same time, but with coupled uniform random variables due to the shared objects underlying the data.

\begin{cor}
  Consider an exchangeable database with two object types, one binary relation between two objects of the first type and a ternary relation between two objects of the first type and one of the type;  denote the first relation by the array $X=(X_{i,j})_{i,j\in\Nats}$ and the second by $Y=(Y_{i,j,k})_{i,j,k\in\Nats}$.
   Then there exists a pair of measurable functions $(F, G)$ and a collection of \iid Uniform$[0,1]$ random variables $U, (\AHvar_{i})_{i\in\Nats}, (\AHvaralt_{i})_{i\in\Nats}, (\AHvar_{\{i,j\}})_{i,j\in\Nats}, (W_{i,j})_{i,j\in\Nats} (Z_{\{i,j\}k})_{i,j,k\in\Nats}$ such that
   \[ 
     X_{ij} & = F(U,\AHvar_{i},\AHvar_{j},  \AHvar_{\{i,j\}}),  \qquad &\text{for } i,j\in\Nats, \\
     Y_{ijk} & = G(U, \AHvar_{i}, U_j \AHvaralt_{k}, \AHvar_{\{i,j\}}, W_{ik}, W_{jk}, Z_{\{i,j\},k}), \qquad &\text{for } i,j,k\in\Nats,
    \]
almost surely.
\end{cor}

That is, this is the Aldous--Hoover representation for a jointly exchangeable array and the Kallenberg representation of a $\pi$-exchangeable array at the same time, but with coupled uniform random variables due to the shared objects underlying the data.

\section{A generic generative model}

In analogy to the work of \cite{Hoff2007a, Roy2009, Lloyd2012} on exchangeable arrays, theorem~\ref{thm:simple-database} naturally inspires a generic generative model of exchangeable databases.
Each object in the database is associated with an \iid sample, $\AHvar_i^t$, from some distribution $\mathcal{U}$ \eg Uniform, Gaussian.
For each relation $r_1,\dotsc,r_R$ we independently sample a random function $F^j$ from some distribution $\mathcal{F}^j$, \eg Gaussian process, random (bi/tri/\ldots)linear function.
We denote the evaluation of these functions at the corresponding values of $(\AHvar_i^t)$ by $W^j$.
$W^j$ can then be used to index into a family of observation distribution $L(\cdot)$, \eg Gaussian distributions, to model the value of the relation $r_j$.
\[
(\AHvar_i^t) & \simiid  \mathcal{U} \\
F^r & \sim  \mathcal{F}^r \\
W^j_{\bi} & \defas F^j(\AHvar^{s_j(1)}_{i_1},\cdots,\AHvar^{s_j(n)}_{i_n}) \\
X^{r_j}_{\bi} \given W & \sim  L(W^j_{\bi}) \qquad \text{independently across $j$ and $\bi$.}
\]

\subsection{Generic discriminative models as well}

\TBD{Demonstrate this remark on regression problems to show that this thinking applies to commonplace practices}

\subsection{Higher order dependencies}

\TBD{Talk about those cross terms and how they could be used. What about dependence between functions?}

\subsection{Prior work using models of this form}

It was demonstrated in \cite{Lloyd2012} that many models of single 2-arrays fit the form of the generic model presented above.
In particular there are models that assume $F$ is linear \citep[e.g.][]{Hoff2007a, Meeds2007, Salakhutdinov2008, Yu2008, Miller2009}, that $F$ is Gaussian process distributed \citep[e.g.][]{Lawrence2009, Yan2011, Lloyd2012} and other non-linear forms for $F$ \citep[e.g.][]{Hoff2002, Roy2009}.
In addition to this there has been a line of work that uses increasingly more expressive forms of the distribution $\mathcal{U}$ \citep[e.g.][]{Wang1987, Nowicki2001, Kemp2006, Xu2006, Meeds2007, Miller2009, Palla2012}.

Many, but not all, of these models have been extended to model $d$-arrays.
A summary of models using linear forms of $F$ is given in \cite{Kolda2009}; non-linear models include \cite{Xu2012}.

For full databases, the literature is limited to clustering models \cite{Kemp2006} and models using linear forms for the $F^r$ \citep[e.g.][]{Acar, Acar2012, Acar2013, Andersen2013, Davison, Ermis1958, Gallinari2011, Jimeng2009, Kong2010, Lippert2008, Networks, Nickel2011, Shangguan2012, Singh, Singha, Singh2008}.

\section{Discussion}

We have demonstrated how the concept of exchangeability can be applied to databases and used to derive a natural parameter space for statistical models of such data.
Identifying a parameter space is the first step in any statistical analysis, allowing either frequentist estimation of the parameters or Bayesian prior specification.
This concept is well established for exchanegable sequences where de Finetti's theorem \citep[e.g.][]{Kallenberg2005} applies.
For exchangeable arrays, the relevant representation theorems were presented by Aldous and Hoover \cite{Aldous1981a, Hoover1979} over 30 years ago but it is only recently that these results are being used to inspire Bayesian models \cite{Hoff2007a, Roy2009, Lloyd2012} and frequentist estimation procedures \cite{Kallenberg1999a,Choi2012, Wolfe2013}.
We hope that this work will continue and be extended to the analysis of exchangeable databases.

\subsection{Mention sparsity again}

\TBD{This is really important to talk about at all times!}

\outbpdocument{
\bibliographystyle{plainnat}
\bibliography{references.bib}
}
